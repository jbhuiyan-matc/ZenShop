# Basic ModSecurity configuration

# Enable ModSecurity
SecRuleEngine On

# Request body processing
SecRequestBodyAccess On
SecRequestBodyLimit 10485760
SecRequestBodyNoFilesLimit 131072
SecRequestBodyLimitAction Reject

# Response body processing
SecResponseBodyAccess On
SecResponseBodyLimit 10485760
SecResponseBodyLimitAction Reject

# Audit log configuration
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"
SecAuditLogParts ABCFHZ
SecAuditLogType Serial
SecAuditLog /var/log/nginx/modsecurity_audit.log

# Basic rules
SecRule REQUEST_HEADERS:Content-Type "(?:application(?:/soap\+|/)|text/)xml" \
     "id:200000,phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML"

SecRule REQUEST_HEADERS:Content-Type "application/json" \
     "id:200001,phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON"

# OWASP Core Rule Set inclusion
Include /etc/nginx/modsecurity/rules/*.conf
